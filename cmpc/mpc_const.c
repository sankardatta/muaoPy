#include "mpc_const.h" 

const real_t HoL[] = { /* Quadratic term (Hessian) matrix of QP over Lipschitz constant. */
0.793318732374, 0.0531275460088, 0.0463119624762, 0.0396645654013, 0.0332095900373, 0.0269721271621, 0.0209782346336, 0.0152550532456, 0.00983092739822, 0.00473553111979, 
0.0531275460088, 0.788159277642, 0.0480036395632, 0.0412260549843, 0.034619276477, 0.0282077198884, 0.02201666904, 0.016072388142, 0.0104022385659, 0.00503480049613, 
0.0463119624762, 0.0480036395632, 0.783042843212, 0.0428951922629, 0.0361261454392, 0.0295284932722, 0.0231266921858, 0.0169460693752, 0.0110129354145, 0.00535470123565, 
0.0396645654013, 0.0412260549843, 0.0428951922629, 0.777910302229, 0.0377368966001, 0.0309403195921, 0.0243132393346, 0.0178799814114, 0.0116657331578, 0.00569665564608, 
0.0332095900373, 0.034619276477, 0.0361261454392, 0.0377368966001, 0.772689595362, 0.0324494759559, 0.0255815859828, 0.0188782765082, 0.0123635341937, 0.00606218408778, 
0.0269721271621, 0.0282077198884, 0.0295284932722, 0.0309403195921, 0.0324494759559, 0.767293576066, 0.0269373713147, 0.0199453931762, 0.013109441009, 0.00645291173337, 
0.0209782346336, 0.02201666904, 0.0231266921858, 0.0243132393346, 0.0255815859828, 0.0269373713147, 0.761617527131, 0.0210860759131, 0.0139067699731, 0.00687057579344, 
0.0152550532456, 0.016072388142, 0.0169460693752, 0.0178799814114, 0.0188782765082, 0.0199453931762, 0.0210860759131, 0.755536300154, 0.0147590660831, 0.00731703324031, 
0.00983092739822, 0.0104022385659, 0.0110129354145, 0.0116657331578, 0.0123635341937, 0.013109441009, 0.0139067699731, 0.0147590660831, 0.748901022581, 0.00779426906432, 
0.00473553111979, 0.00503480049613, 0.00535470123565, 0.00569665564608, 0.00606218408778, 0.00645291173337, 0.00687057579344, 0.00731703324031, 0.00779426906432, 0.741535308956, 
 
};
const real_t GoL[] = { /* Linear term matrix of the QP, over Lipschitz constant. */
54.4677362452, 5.91844056837, 
45.0092323055, 5.22664865553, 
36.2887453399, 4.55030930403, 
28.3571535788, 3.89179446615, 
21.268842752, 3.25355534355, 
15.081947893, 2.63813328557, 
9.85861181263, 2.04817108827, 
5.66526139133, 1.48642474461, 
2.57290291939, 0.955775697735, 
0.657437797253, 0.459243652245, 

};
const real_t Bh_T[] = { /* Extended input matrix (used for reference tracking). */
1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 0.00012477826758, 0.007920362207, 0.000155426749882, 0.00740955416863, 0.000184098619157, 0.00693168968072, 0.000210921353137, 0.00648464411439, 0.000236014208133, 0.00606642986445, 0.000259488749256, 0.0056751875124, 0.000281449346447, 0.00530917755922, 
0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 0.00012477826758, 0.007920362207, 0.000155426749882, 0.00740955416863, 0.000184098619157, 0.00693168968072, 0.000210921353137, 0.00648464411439, 0.000236014208133, 0.00606642986445, 0.000259488749256, 0.0056751875124, 
0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 0.00012477826758, 0.007920362207, 0.000155426749882, 0.00740955416863, 0.000184098619157, 0.00693168968072, 0.000210921353137, 0.00648464411439, 0.000236014208133, 0.00606642986445, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 0.00012477826758, 0.007920362207, 0.000155426749882, 0.00740955416863, 0.000184098619157, 0.00693168968072, 0.000210921353137, 0.00648464411439, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 0.00012477826758, 0.007920362207, 0.000155426749882, 0.00740955416863, 0.000184098619157, 0.00693168968072, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 0.00012477826758, 0.007920362207, 0.000155426749882, 0.00740955416863, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 0.00012477826758, 0.007920362207, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 9.20169063153e-05, 0.00846638489474, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 5.6997006102e-05, 0.0090500498983, 
0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.95628652846e-05, 0.00967395224526, 

};
const real_t E[] = { /* Linear factor (prediction matrix) of 2-sided state constraint. */
0, 

};
const real_t Kx_Ai[] = { /* Prediction component of the state constraint bound. */
0, 

};

const real_t u_lb[] = { /* Left (lower) constraint of the inputs for condensed QP. */
-100, 
-100, 
-100, 
-100, 
-100, 
-100, 
-100, 
-100, 
-100, 
-100, 

};
const real_t u_ub[] = { /* Right (upper) constraint of the inputs for condensed QP. */
100, 
100, 
100, 
100, 
100, 
100, 
100, 
100, 
100, 
100, 

};
const real_t e_lb[] = { /* Left (lower) constraint of the states for condensed QP. */
0, 

};
const real_t e_ub[] = { /* Right (upper) constraint of the states for condensed QP. */
0, 

};

const real_t nu = 0.0766523923634; /* Fast gradient extra step constant */
const real_t mu = 0.0; /* Augmented Lagrange multiplier penalty parameter. */
const real_t Linv = 3.05512876607; /* Inverse of gradient Lipschitz constant (1/L) */

/* state dependent variables */
real_t gxoL[MPC_HOR_INPUTS];  /* gradient vector as a function of the current state */
real_t zx_lb[MPC_HOR_MXCONSTRS];  /* mixed constraint lower bound as function of current state */
real_t zx_ub[MPC_HOR_MXCONSTRS];  /* mixed constraint upper bound as function of current state */

/* reference dependent variables */
real_t groL[MPC_HOR_INPUTS];

/* MPC system: state-space and weighting matrices */
const real_t Q[] = {  /* State weighting matrix */
11000.0, 0.0, 
0.0, 29.0, 

};
const real_t R[] = {   /* Input weighting matrix */
0.24, 

};
const real_t P[] = {   /* Terminal state weighting matrix */
11000.0, 0.0, 
0.0, 29.0, 

};
const real_t K[] = {   /* Linear quadratic regulator gain matrix */
0, 

};
const real_t Ad[] = {   /* Discrete-time system matrix */
1.0, 0.0038695808981, 
0.0, 0.935506985032, 

};
const real_t Bd[] = {   /* Discrete-time input matrix */
1.95628652846e-05, 
0.00967395224526, 

};
const real_t dt = 0.004;


/* User variables created with appropriate size */
real_t u_opt[MPC_HOR_INPUTS];  /* Optimal input */
real_t l_opt[MPC_HOR_MXCONSTRS];  /* Optimal multiplier */
real_t x_trj[MPC_HOR_STATES + MPC_STATES];  /* State trajectory for u_opt */
real_t u_ini[MPC_HOR_INPUTS];  /* Initial guess input */
real_t l_ini[MPC_HOR_MXCONSTRS];  /* Initial guess multiplier */

/* Always check this declarations match the structure definitions */
struct mpc_conf conf = {1, 1, 0};

struct mpc_qpx qpx = {HoL, gxoL, E, u_lb, u_ub, zx_lb, zx_ub,
		MPC_HOR_INPUTS, MPC_HOR_MXCONSTRS};

struct mpc_sys sys = {Ad, Bd, &dt};

struct mpc_wmx wmx = {Q, R, P,};

struct mpc_lqr lqr = {K, P,};

struct mpc_fgm fgm = {u_ini, gxoL, groL, &(conf.in_iter),
			HoL, GoL, Bh_T, u_lb, u_ub, &nu,
			MPC_HOR, MPC_STATES, MPC_INPUTS, MPC_HOR_INPUTS, MPC_HOR_STATES};

struct mpc_alm alm = {&fgm, l_ini, zx_lb, zx_ub, &(conf.ex_iter),
			&mu,
			E, Kx_Ai, e_lb, e_ub,
			&Linv, 
			MPC_STATES, MPC_MXCONSTRS, MPC_HOR_INPUTS, MPC_HOR_MXCONSTRS};

struct mpc_ctl ctl = {&conf, &qpx, &sys, &wmx, &lqr, &alm,
			u_opt, l_opt, x_trj, 0, 0, u_ini, l_ini};

